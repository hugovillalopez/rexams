/* eslint-disable @typescript-eslint/no-var-requires */
import { findChildren } from '@milkdown/utils';
import { Decoration, DecorationSet } from 'prosemirror-view';
export function getDecorations(doc, highlighter, name) {
    const decorations = [];
    findChildren((node) => node.type.name === name)(doc).forEach(async (block) => {
        let from = block.pos + 1;
        const { language } = block.node.attrs;
        if (!language)
            return;
        const nodes = highlighter.codeToThemedTokens(block.node.textContent, language).map((token) => token.map(({ content, color }) => ({
            content,
            color,
        })));
        nodes.forEach((block) => {
            block.forEach((node) => {
                const to = from + node.content.length;
                const decoration = Decoration.inline(from, to, {
                    style: `color: ${node.color}`,
                });
                decorations.push(decoration);
                from = to;
            });
            from += 1;
        });
    });
    return DecorationSet.create(doc, decorations);
}
